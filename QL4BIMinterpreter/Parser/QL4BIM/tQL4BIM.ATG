COMPILER QL4BIM
public delegate void PartParsedEventHandler(object sender, PartParsedEventArgs e);
public event PartParsedEventHandler PartParsed;
 
protected virtual void OnParsed(ParserParts context, string currentToken = "", string lookAhead = "") 
{	
	var e = new PartParsedEventArgs(context, currentToken, lookAhead);
    Console.WriteLine(e.ToString());
    PartParsed?.Invoke(this, e);
}


CHARACTERS

	digit = "0123456789".
	up = "ABCDEFGHIJKLMNOPQRSTUVWXYZ".
	low = "abcdefghijklmnopqrstuvwxyz".
	specials =":.-_\\".
	cr  = '\r'.
	lf  = '\n'.
	tab = '\t'.
	str = up + low + digit.
	add = '+'.
	minus = '-'.
 

TOKENS
	float = [add|minus] digit {digit} '.' {digit} ['E' [add|minus] digit {digit}].
	number = [add|minus] digit {digit}.
	lowString = low {low | up | digit}.
	upString = up {low | up  | digit}.
	string_ = '\"' { str | specials } '\"'.
	minust = minus.
	alias = ":" (up | low)(up | low | digit)[up | low | digit].

COMMENTS FROM "/*" TO "*/" NESTED
COMMENTS FROM "//" TO lf
IGNORE cr + lf + tab

PRODUCTIONS

	QL4BIM												
	= 		
	(																(.  OnParsed(ParserParts.GlobalBlock); .)
	statement_ {statement_} {func_})
	|
	( func_ {func_})
	.						
	/*=====================================================*/

	statement_														(.  OnParsed(ParserParts.Statement); .)	
	=																
	lowString														(.  OnParsed(ParserParts.Variable, t.val); .)						
	{																
	"[]"															(.  OnParsed(ParserParts.EmptyRelAtt); .)
	|"[" lowString													(.  OnParsed(ParserParts.RelAtt, t.val); .)			
	 "|" lowString													(.  OnParsed(ParserParts.RelAtt, t.val); .)
	{
	"|" lowString													(.  OnParsed(ParserParts.RelAtt, t.val); .)
	}													
	"]"
	}
	"="													
	expression
	.						
	/*=====================================================*/

	expression														
	= 
	upString														(.  OnParsed(ParserParts.Operator, t.val); .)
	"("													
		argument													
	{ ","										
		argument								
	} ")"
	.
	/*=====================================================*/

	argument													(.  OnParsed(ParserParts.Arguement); .)
	=
	setRelAttLongShort 
	[
	exType													(.  OnParsed(ParserParts.TypePrdicate); .)	
	| exAtt 
	[														(.  OnParsed(ParserParts.AttPredicate); .)	
	attPredicate											
	]  
	|														(.  OnParsed(ParserParts.CountPredicate); .)	
	countPredicate 
	] 					
	|																				
	constant												
	.
	/*=====================================================*/

	constant =  
	string_ 												(.  OnParsed(ParserParts.String, t.val); .)	
	| number 												(.  OnParsed(ParserParts.Number, t.val); .)	
	| float 												(.  OnParsed(ParserParts.Float, t.val); .)	
	| bool_														
	.
	/*=====================================================*/

	bool_ 
	=														
	"true" 													(.  OnParsed(ParserParts.Bool,t.val); .)
	| "false" 												(.  OnParsed(ParserParts.Bool,t.val); .)
	| "unknown"												(.  OnParsed(ParserParts.Bool,t.val); .)
	.
	/*=====================================================*/

	attPredicate											
	=
	 equalsPred | inPred | morePred | moreEqulPred | lessPred | lessEqulPred
	 .
	/*=====================================================*/

	equalsPred												(.  OnParsed(ParserParts.EqualsPred); .)	
	= "=" (constant | setRelAttPredEnd).

	inPred													(.  OnParsed(ParserParts.InPred); .)	
	= "~" 
	(string_												(.  OnParsed(ParserParts.String, t.val); .)	
	| setRelAttPredEnd).

	morePred												(.  OnParsed(ParserParts.MorePred); .)	
	= ">"  numericOrSetRelAtt.

	moreEqulPred											(.  OnParsed(ParserParts.MoreEqualPred); .)	
	= ">="  numericOrSetRelAtt.

	lessPred												(.  OnParsed(ParserParts.LessPred); .)	
	= "<"  numericOrSetRelAtt.

	lessEqulPred											(.  OnParsed(ParserParts.LessEqualPred); .)	
	= "<="  numericOrSetRelAtt.

	countPredicate											
	= (
	">"														(.  OnParsed(ParserParts.MorePred); .)
	| ">=" 													(.  OnParsed(ParserParts.MoreEqualPred); .)
	| "<"													(.  OnParsed(ParserParts.LessPred); .)
	| "<="													(.  OnParsed(ParserParts.LessEqualPred); .)
	| "="													(.  OnParsed(ParserParts.EqualsPred); .)
	) 
	number													(.  OnParsed(ParserParts.Number, t.val); .)	
	.
	/*=====================================================*/

	relAtt = 
	"["		
	lowString												(.  OnParsed(ParserParts.RelAtt, t.val); .)	
	"]"
	.								
	/*=====================================================*/

	exAtt = 
	"." (lowString | upString)								(.  OnParsed(ParserParts.ExAtt, t.val); .)	
	.
	/*=====================================================*/

	exType = "is" (lowString | upString)					(.  OnParsed(ParserParts.ExType, t.val); .)	
	.
	/*=====================================================*/


	setRelAttLongShort =
	 lowString												(.  OnParsed(ParserParts.SetRelArg, t.val); .)
	 [ 
	 relAtt													
	 ]												
	 | relAtt												
	 .
	/*=====================================================*/

	setRelFormalArg =										(.  OnParsed(ParserParts.SetRelFormalArg); .)
	lowString												(.  OnParsed(ParserParts.SetRelArg, t.val); .)
	[ "[" lowString											(.  OnParsed(ParserParts.RelAtt, t.val); .)	
	 "|" lowString											(.  OnParsed(ParserParts.RelAtt, t.val); .)	
	 {"|" 
	 lowString												(.  OnParsed(ParserParts.RelAtt, t.val); .)	
	 }  
	 "]" ].
	/*=====================================================*/

	func_ =													(.  OnParsed(ParserParts.FuncDefBlock); .)
	"func" 
	upString												(.  OnParsed(ParserParts.DefOp,t.val); .)
	[alias													(.  OnParsed(ParserParts.DefAlias,t.val); .)
	]
	"(" setRelFormalArg {"," setRelFormalArg } ")" 
	"(" statement_ {statement_} ")".
	/*=====================================================*/

	numericOrSetRelAtt										(.  OnParsed(ParserParts.NumericOrSetRelAtt); .)
	= 
	number 													(.  OnParsed(ParserParts.Number, t.val); .)	
	| float													(.  OnParsed(ParserParts.Float, t.val); .)	
	| setRelAttPredEnd.
	/*=====================================================*/
	
	setRelAttPredEnd										(.  OnParsed(ParserParts.SetRelAttPredEnd); .)
	= setRelAttLongShort exAtt.

END QL4BIM.  